# Migration `20201128031213-a`

This migration has been generated by SigmaGF at 11/28/2020, 12:12:13 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."receipts" DROP CONSTRAINT "receipts_fk"

ALTER TABLE "public"."receipts" DROP CONSTRAINT "receipts_fk_1"

ALTER TABLE "public"."clients" DROP CONSTRAINT "clientes_pkey",
DROP COLUMN "id",
ADD COLUMN "id" text   NOT NULL ,
ADD PRIMARY KEY ("id")

ALTER TABLE "public"."receipts" DROP CONSTRAINT "recibos_pkey",
DROP COLUMN "id",
ADD COLUMN "id" text   NOT NULL ,
DROP COLUMN "clientId",
ADD COLUMN "clientId" text   NOT NULL ,
DROP COLUMN "vehicleId",
ADD COLUMN "vehicleId" text   NOT NULL ,
ADD PRIMARY KEY ("id")

ALTER TABLE "public"."users" DROP CONSTRAINT "usuarios_pkey",
DROP COLUMN "id",
ADD COLUMN "id" text   NOT NULL ,
ADD PRIMARY KEY ("id")

ALTER TABLE "public"."vehicles" DROP CONSTRAINT "veiculos_pkey",
DROP COLUMN "id",
ADD COLUMN "id" text   NOT NULL ,
ADD PRIMARY KEY ("id")

ALTER TABLE "public"."receipts" ADD FOREIGN KEY ("clientId")REFERENCES "public"."clients"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."receipts" ADD FOREIGN KEY ("vehicleId")REFERENCES "public"."vehicles"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201128031213-a
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,67 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model User {
+  id              String    @id @default(uuid())
+  name            String
+  email           String    @unique
+  password        String
+  newEmail        String?
+  newEmailToken   String?
+  newEmailExpires String?
+  pwdRstToken     String?
+  pwdRstExpires   DateTime?
+  createdAt       DateTime  @default(now())
+  updatedAt       DateTime  @default(now()) @updatedAt
+
+  @@map("users")
+}
+
+model Client {
+  id        String    @id @default(uuid())
+  name      String
+  document  String    @unique
+  group     String?
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @default(now()) @updatedAt
+  
+  Receipt   Receipt[] @relation("receipt-client")
+
+  @@map("clients")
+}
+
+model Vehicle {
+  id         String    @id @default(uuid())
+  plate      String    @unique
+  renavam    String    @unique
+  brandModel String
+  type       String
+  createdAt  DateTime  @default(now())
+  updatedAt  DateTime  @default(now()) @updatedAt
+
+  Receipt    Receipt[] @relation("receipt-vehicle")
+
+  @@map("vehicles")
+}
+
+model Receipt {
+  id        String    @id @default(uuid())
+  clientId  String
+  vehicleId String
+  details   String?
+  status    String
+  issuedOn  DateTime?
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @default(now()) @updatedAt
+
+  client    Client    @relation("receipt-client", fields: [clientId], references: [id])
+  vehicle   Vehicle   @relation("receipt-vehicle", fields: [vehicleId], references: [id])
+
+  @@map("receipts")
+}
```


