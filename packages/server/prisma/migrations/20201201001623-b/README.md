# Migration `20201201001623-b`

This migration has been generated by SigmaGF at 11/30/2020, 9:16:23 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."receipts" DROP CONSTRAINT "receipts_clients"

ALTER TABLE "public"."receipts" DROP CONSTRAINT "receipts_vehicles"

ALTER TABLE "public"."clients" DROP CONSTRAINT "clientes_pkey",
DROP COLUMN "id",
ADD COLUMN "id" text   NOT NULL ,
ADD PRIMARY KEY ("id")

ALTER TABLE "public"."receipts" DROP CONSTRAINT "recibos_pkey",
DROP COLUMN "id",
ADD COLUMN "id" text   NOT NULL ,
DROP COLUMN "clientId",
ADD COLUMN "clientId" text   NOT NULL ,
DROP COLUMN "vehicleId",
ADD COLUMN "vehicleId" text   NOT NULL ,
ADD PRIMARY KEY ("clientId", "vehicleId")

ALTER TABLE "public"."users" DROP CONSTRAINT "usuarios_pkey",
DROP COLUMN "id",
ADD COLUMN "id" text   NOT NULL ,
ADD PRIMARY KEY ("id")

ALTER TABLE "public"."vehicles" DROP CONSTRAINT "veiculos_pkey",
DROP COLUMN "id",
ADD COLUMN "id" text   NOT NULL ,
ADD PRIMARY KEY ("id")

CREATE UNIQUE INDEX "receipts.id_unique" ON "public"."receipts"("id")

ALTER TABLE "public"."receipts" ADD FOREIGN KEY ("clientId")REFERENCES "public"."clients"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."receipts" ADD FOREIGN KEY ("vehicleId")REFERENCES "public"."vehicles"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201130012021-a..20201201001623-b
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
   id              String    @id @default(uuid())
@@ -50,9 +50,9 @@
   @@map("vehicles")
 }
 model Receipt {
-  id        String    @id @default(uuid())
+  id        String    @unique @default(uuid())
   clientId  String
   vehicleId String
   details   String?
   status    String
@@ -63,5 +63,6 @@
   client    Client    @relation("receipt-client", fields: [clientId], references: [id])
   vehicle   Vehicle   @relation("receipt-vehicle", fields: [vehicleId], references: [id])
   @@map("receipts")
+  @@id([clientId, vehicleId])
 }
```


