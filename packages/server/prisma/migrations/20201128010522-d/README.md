# Migration `20201128010522-d`

This migration has been generated by SigmaGF at 11/27/2020, 10:05:22 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."recibos.placa_unique"

DROP INDEX "public"."recibos.renavam_unique"

ALTER TABLE "public"."recibos" DROP COLUMN "placa",
DROP COLUMN "renavam",
DROP COLUMN "marcaModelo",
DROP COLUMN "tipo",
ADD COLUMN "veiculoId" text   NOT NULL 

CREATE TABLE "public"."veiculos" (
"id" text   NOT NULL ,
"placa" text   NOT NULL ,
"renavam" text   NOT NULL ,
"marcaModelo" text   NOT NULL ,
"tipo" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "veiculos.placa_unique" ON "public"."veiculos"("placa")

CREATE UNIQUE INDEX "veiculos.renavam_unique" ON "public"."veiculos"("renavam")

ALTER TABLE "public"."recibos" ADD FOREIGN KEY ("veiculoId")REFERENCES "public"."veiculos"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201127231742-b..20201128010522-d
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Cliente {
   id         String    @id @default(uuid())
@@ -17,21 +17,31 @@
   @@map("clientes")
 }
-model Recibo {
+model Veiculo {
   id           String     @id @default(uuid())
-  clienteId    String
   placa        String     @unique
   renavam      String     @unique
   marcaModelo  String
   tipo         String
+  createdAt    DateTime   @default(now())
+  updatedAt    DateTime   @default(now()) @updatedAt
+
+  @@map("veiculos")
+}
+
+model Recibo {
+  id           String     @id @default(uuid())
+  clienteId    String
+  veiculoId    String
   detalhes     String?
   emitidoEm    DateTime?
   situacao     String
   createdAt    DateTime   @default(now())
   updatedAt    DateTime   @default(now()) @updatedAt
   cliente     Cliente  @relation("recibo-cliente", fields: [clienteId], references: [id])
+  veiculo     Veiculo  @relation("recibo-veiculo", fields: [veiculoId], references: [id])
   @@map("recibos")
 }
```


