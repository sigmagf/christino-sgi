# Migration `20201201210251-add-works`

This migration has been generated by SigmaGF at 12/1/2020, 6:02:51 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."receipts" DROP COLUMN "status",
ADD COLUMN "status" integer   NOT NULL DEFAULT 1

DROP TYPE "ReceiptType"

CREATE TABLE "public"."works" (
"id" text   NOT NULL ,
"clientId" text   NOT NULL ,
"vehicleId" text   NOT NULL ,
"description" text   NOT NULL ,
"status" integer   NOT NULL DEFAULT 1,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."workEntries" (
"id" text   NOT NULL ,
"workId" text   NOT NULL ,
"details" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

ALTER TABLE "public"."workEntries" ADD FOREIGN KEY ("workId")REFERENCES "public"."works"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."workEntries" ADD FOREIGN KEY ("workId")REFERENCES "public"."works"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201201005545-refactory..20201201210251-add-works
--- datamodel.dml
+++ datamodel.dml
@@ -3,18 +3,11 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
-enum ReceiptType {
-  ORIGINAL
-  XEROX
-  OUTRO
-  BAIXADO
-}
-
 model User {
   id        String   @id @default(uuid())
   name      String
   email     String   @unique
@@ -55,15 +48,40 @@
 model Receipt {
   clientId  String
   vehicleId String
   details   String?
-  status    ReceiptType
+  status    Int       @default(1)
   issuedOn  DateTime?
-  createdAt DateTime    @default(now())
-  updatedAt DateTime    @default(now()) @updatedAt
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @default(now()) @updatedAt
-  client    Client      @relation("receipt-client", fields: [clientId], references: [id])
-  vehicle   Vehicle     @relation("receipt-vehicle", fields: [vehicleId], references: [id])
+  client    Client    @relation("receipt-client", fields: [clientId], references: [id])
+  vehicle   Vehicle   @relation("receipt-vehicle", fields: [vehicleId], references: [id])
   @@id([clientId, vehicleId])
   @@map("receipts")
 }
+
+model Work {
+  id          String    @id @default(uuid())
+  clientId    String
+  vehicleId   String
+  description String
+  status      Int       @default(1)
+  createdAt   DateTime  @default(now())
+  updatedAt   DateTime  @default(now()) @updatedAt
+
+  entries     WorkEntry[]
+
+  @@map("works")
+}
+
+model WorkEntry {
+  id        String   @id @default(uuid())
+  workId    String 
+  details   String
+  createdAt DateTime @default(now())
+
+  work      Work     @relation("workEntry-work", fields: [workId], references: [id])
+
+  @@map("workEntries")
+}
```


